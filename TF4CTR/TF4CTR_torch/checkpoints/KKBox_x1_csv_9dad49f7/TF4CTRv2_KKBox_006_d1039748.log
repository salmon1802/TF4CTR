2024-04-11 17:15:52,135 P538965 INFO Params: {
    "DFM": "WSF",
    "SSM": "SER",
    "alpha": "0.25",
    "batch_norm": "True",
    "batch_size": "10000",
    "c": "0.8",
    "data_format": "csv",
    "data_root": "../../../data/",
    "dataset_id": "KKBox_x1_csv_9dad49f7",
    "debug_mode": "False",
    "early_stop_patience": "2",
    "easy_hidden_units": "[400]",
    "embedding_dim": "16",
    "embedding_regularizer": "0.0005",
    "epochs": "100",
    "eval_steps": "None",
    "feature_cols": "[{'active': True, 'dtype': 'int', 'name': 'group_id', 'preprocess': 'copy_from(msno)', 'remap': False, 'type': 'meta'}, {'active': True, 'dtype': 'str', 'name': ['msno', 'song_id', 'source_system_tab', 'source_screen_name', 'source_type', 'city', 'gender', 'registered_via', 'language'], 'type': 'categorical'}, {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'genre_ids', 'type': 'sequence'}, {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'artist_name', 'type': 'sequence'}, {'active': True, 'dtype': 'str', 'name': 'isrc', 'preprocess': 'extract_country_code', 'type': 'categorical'}, {'active': True, 'dtype': 'str', 'name': 'bd', 'preprocess': 'bucketize_age', 'type': 'categorical'}]",
    "feature_config": "None",
    "feature_specs": "None",
    "gamma": "1",
    "gpu": "0",
    "group_id": "group_id",
    "hard_hidden_units": "[400, 400, 400]",
    "hidden_activations": "relu",
    "label_col": "{'dtype': 'float', 'name': 'label'}",
    "learning_rate": "0.001",
    "loss": "binary_crossentropy",
    "metrics": "['logloss', 'AUC', 'gAUC']",
    "min_categr_count": "2",
    "model": "TF4CTRv2",
    "model_id": "TF4CTRv2_KKBox_006_d1039748",
    "model_root": "./checkpoints/",
    "monitor": "{'AUC': 1, 'gAUC': 1, 'logloss': 0}",
    "monitor_mode": "max",
    "net_dropout": "0.2",
    "net_regularizer": "0",
    "num_workers": "8",
    "optimizer": "adam",
    "pickle_feature_encoder": "True",
    "save_best_only": "True",
    "seed": "2023",
    "shuffle": "True",
    "task": "binary_classification",
    "test_data": "../../../data/KKBox_x1/test.csv",
    "train_data": "../../../data/KKBox_x1/train.csv",
    "use_features": "None",
    "valid_data": "../../../data/KKBox_x1/valid.csv",
    "verbose": "1"
}
2024-04-11 17:15:52,135 P538965 INFO Set up feature processor...
2024-04-11 17:15:52,136 P538965 WARNING Skip rebuilding ../../../data/KKBox_x1_csv_9dad49f7/feature_map.json. Please delete it manually if rebuilding is required.
2024-04-11 17:15:52,136 P538965 INFO Load feature_map from json: ../../../data/KKBox_x1_csv_9dad49f7/feature_map.json
2024-04-11 17:15:52,136 P538965 INFO Set column index...
2024-04-11 17:15:52,136 P538965 INFO Feature specs: {
    "artist_name": "{'source': '', 'type': 'sequence', 'feature_encoder': 'layers.MaskedAveragePooling()', 'padding_idx': 0, 'oov_idx': 25368, 'vocab_size': 25369, 'max_len': 3}",
    "bd": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 8, 'vocab_size': 9}",
    "city": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 22, 'vocab_size': 23}",
    "gender": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 3, 'vocab_size': 4}",
    "genre_ids": "{'source': '', 'type': 'sequence', 'feature_encoder': 'layers.MaskedAveragePooling()', 'padding_idx': 0, 'oov_idx': 482, 'vocab_size': 483, 'max_len': 3}",
    "group_id": "{'type': 'meta'}",
    "isrc": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 96, 'vocab_size': 97}",
    "language": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 11, 'vocab_size': 12}",
    "msno": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 29505, 'vocab_size': 29506}",
    "registered_via": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 6, 'vocab_size': 7}",
    "song_id": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 172296, 'vocab_size': 172297}",
    "source_screen_name": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 21, 'vocab_size': 22}",
    "source_system_tab": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 9, 'vocab_size': 10}",
    "source_type": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 13, 'vocab_size': 14}"
}
2024-04-11 17:15:56,071 P538965 INFO Total number of parameters: 5918876.
2024-04-11 17:15:56,072 P538965 INFO Loading data...
2024-04-11 17:15:56,072 P538965 INFO Loading data from h5: ../../../data/KKBox_x1_csv_9dad49f7/train.h5
2024-04-11 17:15:57,879 P538965 INFO Train samples: total/5901932, blocks/1
2024-04-11 17:15:57,879 P538965 INFO Loading data from h5: ../../../data/KKBox_x1_csv_9dad49f7/valid.h5
2024-04-11 17:15:58,102 P538965 INFO Validation samples: total/737743, blocks/1
2024-04-11 17:15:58,103 P538965 INFO Loading train and validation data done.
2024-04-11 17:15:58,103 P538965 INFO Start training: 591 batches/epoch
2024-04-11 17:15:58,103 P538965 INFO ************ Epoch=1 start ************
2024-04-11 17:16:37,443 P538965 INFO Train loss: 1.074778
2024-04-11 17:16:37,443 P538965 INFO Evaluation @epoch 1 - batch 591: 
2024-04-11 17:16:49,695 P538965 INFO ===
2024-04-11 17:16:49,695 P538965 INFO [Metrics] AUC: 0.803109 - gAUC: 0.725618 - logloss: 0.537759
2024-04-11 17:16:49,696 P538965 INFO Save best model: monitor(max)=1.528727
2024-04-11 17:16:49,855 P538965 INFO ************ Epoch=1 end ************
2024-04-11 17:17:29,789 P538965 INFO Train loss: 1.028816
2024-04-11 17:17:29,789 P538965 INFO Evaluation @epoch 2 - batch 591: 
2024-04-11 17:17:44,224 P538965 INFO ===
2024-04-11 17:17:44,225 P538965 INFO [Metrics] AUC: 0.813034 - gAUC: 0.739192 - logloss: 0.526396
2024-04-11 17:17:44,225 P538965 INFO Save best model: monitor(max)=1.552226
2024-04-11 17:17:44,489 P538965 INFO ************ Epoch=2 end ************
2024-04-11 17:18:23,982 P538965 INFO Train loss: 1.023871
2024-04-11 17:18:23,983 P538965 INFO Evaluation @epoch 3 - batch 591: 
2024-04-11 17:18:37,705 P538965 INFO ===
2024-04-11 17:18:37,705 P538965 INFO [Metrics] AUC: 0.818722 - gAUC: 0.746919 - logloss: 0.520345
2024-04-11 17:18:37,706 P538965 INFO Save best model: monitor(max)=1.565641
2024-04-11 17:18:37,992 P538965 INFO ************ Epoch=3 end ************
2024-04-11 17:19:18,027 P538965 INFO Train loss: 1.020931
2024-04-11 17:19:18,028 P538965 INFO Evaluation @epoch 4 - batch 591: 
2024-04-11 17:19:32,765 P538965 INFO ===
2024-04-11 17:19:32,765 P538965 INFO [Metrics] AUC: 0.821551 - gAUC: 0.750651 - logloss: 0.516199
2024-04-11 17:19:32,766 P538965 INFO Save best model: monitor(max)=1.572201
2024-04-11 17:19:33,024 P538965 INFO ************ Epoch=4 end ************
2024-04-11 17:20:14,317 P538965 INFO Train loss: 1.018450
2024-04-11 17:20:14,317 P538965 INFO Evaluation @epoch 5 - batch 591: 
2024-04-11 17:20:27,655 P538965 INFO ===
2024-04-11 17:20:27,655 P538965 INFO [Metrics] AUC: 0.824021 - gAUC: 0.753917 - logloss: 0.513563
2024-04-11 17:20:27,656 P538965 INFO Save best model: monitor(max)=1.577937
2024-04-11 17:20:27,933 P538965 INFO ************ Epoch=5 end ************
2024-04-11 17:21:10,266 P538965 INFO Train loss: 1.015992
2024-04-11 17:21:10,266 P538965 INFO Evaluation @epoch 6 - batch 591: 
2024-04-11 17:21:23,353 P538965 INFO ===
2024-04-11 17:21:23,354 P538965 INFO [Metrics] AUC: 0.825609 - gAUC: 0.755300 - logloss: 0.511478
2024-04-11 17:21:23,354 P538965 INFO Save best model: monitor(max)=1.580909
2024-04-11 17:21:23,593 P538965 INFO ************ Epoch=6 end ************
2024-04-11 17:22:04,511 P538965 INFO Train loss: 1.014042
2024-04-11 17:22:04,511 P538965 INFO Evaluation @epoch 7 - batch 591: 
2024-04-11 17:22:18,174 P538965 INFO ===
2024-04-11 17:22:18,175 P538965 INFO [Metrics] AUC: 0.826721 - gAUC: 0.756818 - logloss: 0.509762
2024-04-11 17:22:18,175 P538965 INFO Save best model: monitor(max)=1.583539
2024-04-11 17:22:18,435 P538965 INFO ************ Epoch=7 end ************
2024-04-11 17:22:59,774 P538965 INFO Train loss: 1.012087
2024-04-11 17:22:59,774 P538965 INFO Evaluation @epoch 8 - batch 591: 
2024-04-11 17:23:13,213 P538965 INFO ===
2024-04-11 17:23:13,213 P538965 INFO [Metrics] AUC: 0.827572 - gAUC: 0.757971 - logloss: 0.508650
2024-04-11 17:23:13,214 P538965 INFO Save best model: monitor(max)=1.585542
2024-04-11 17:23:13,470 P538965 INFO ************ Epoch=8 end ************
2024-04-11 17:23:54,100 P538965 INFO Train loss: 1.010367
2024-04-11 17:23:54,100 P538965 INFO Evaluation @epoch 9 - batch 591: 
2024-04-11 17:24:07,671 P538965 INFO ===
2024-04-11 17:24:07,671 P538965 INFO [Metrics] AUC: 0.828556 - gAUC: 0.758401 - logloss: 0.507380
2024-04-11 17:24:07,672 P538965 INFO Save best model: monitor(max)=1.586956
2024-04-11 17:24:07,911 P538965 INFO ************ Epoch=9 end ************
2024-04-11 17:24:45,886 P538965 INFO Train loss: 1.008858
2024-04-11 17:24:45,886 P538965 INFO Evaluation @epoch 10 - batch 591: 
2024-04-11 17:24:58,217 P538965 INFO ===
2024-04-11 17:24:58,218 P538965 INFO [Metrics] AUC: 0.828960 - gAUC: 0.759532 - logloss: 0.507104
2024-04-11 17:24:58,219 P538965 INFO Save best model: monitor(max)=1.588491
2024-04-11 17:24:58,451 P538965 INFO ************ Epoch=10 end ************
2024-04-11 17:25:38,128 P538965 INFO Train loss: 1.007602
2024-04-11 17:25:38,128 P538965 INFO Evaluation @epoch 11 - batch 591: 
2024-04-11 17:25:50,975 P538965 INFO ===
2024-04-11 17:25:50,975 P538965 INFO [Metrics] AUC: 0.829604 - gAUC: 0.759494 - logloss: 0.506079
2024-04-11 17:25:50,976 P538965 INFO Save best model: monitor(max)=1.589099
2024-04-11 17:25:51,255 P538965 INFO ************ Epoch=11 end ************
2024-04-11 17:26:28,388 P538965 INFO Train loss: 1.006282
2024-04-11 17:26:28,389 P538965 INFO Evaluation @epoch 12 - batch 591: 
2024-04-11 17:26:41,348 P538965 INFO ===
2024-04-11 17:26:41,349 P538965 INFO [Metrics] AUC: 0.830006 - gAUC: 0.760222 - logloss: 0.505482
2024-04-11 17:26:41,349 P538965 INFO Save best model: monitor(max)=1.590228
2024-04-11 17:26:41,616 P538965 INFO ************ Epoch=12 end ************
2024-04-11 17:27:19,742 P538965 INFO Train loss: 1.005361
2024-04-11 17:27:19,742 P538965 INFO Evaluation @epoch 13 - batch 591: 
2024-04-11 17:27:32,192 P538965 INFO ===
2024-04-11 17:27:32,192 P538965 INFO [Metrics] AUC: 0.830681 - gAUC: 0.760542 - logloss: 0.504661
2024-04-11 17:27:32,192 P538965 INFO Save best model: monitor(max)=1.591223
2024-04-11 17:27:32,457 P538965 INFO ************ Epoch=13 end ************
2024-04-11 17:28:10,135 P538965 INFO Train loss: 1.004286
2024-04-11 17:28:10,135 P538965 INFO Evaluation @epoch 14 - batch 591: 
2024-04-11 17:28:23,394 P538965 INFO ===
2024-04-11 17:28:23,395 P538965 INFO [Metrics] AUC: 0.830804 - gAUC: 0.761302 - logloss: 0.505271
2024-04-11 17:28:23,395 P538965 INFO Save best model: monitor(max)=1.592106
2024-04-11 17:28:23,658 P538965 INFO ************ Epoch=14 end ************
2024-04-11 17:29:02,148 P538965 INFO Train loss: 1.003424
2024-04-11 17:29:02,149 P538965 INFO Evaluation @epoch 15 - batch 591: 
2024-04-11 17:29:14,757 P538965 INFO ===
2024-04-11 17:29:14,757 P538965 INFO [Metrics] AUC: 0.830960 - gAUC: 0.761352 - logloss: 0.504345
2024-04-11 17:29:14,758 P538965 INFO Save best model: monitor(max)=1.592312
2024-04-11 17:29:15,045 P538965 INFO ************ Epoch=15 end ************
2024-04-11 17:29:55,847 P538965 INFO Train loss: 1.002738
2024-04-11 17:29:55,847 P538965 INFO Evaluation @epoch 16 - batch 591: 
2024-04-11 17:30:09,447 P538965 INFO ===
2024-04-11 17:30:09,448 P538965 INFO [Metrics] AUC: 0.831820 - gAUC: 0.762181 - logloss: 0.503466
2024-04-11 17:30:09,448 P538965 INFO Save best model: monitor(max)=1.594000
2024-04-11 17:30:09,709 P538965 INFO ************ Epoch=16 end ************
2024-04-11 17:30:50,508 P538965 INFO Train loss: 1.002029
2024-04-11 17:30:50,508 P538965 INFO Evaluation @epoch 17 - batch 591: 
2024-04-11 17:31:03,558 P538965 INFO ===
2024-04-11 17:31:03,559 P538965 INFO [Metrics] AUC: 0.831890 - gAUC: 0.762595 - logloss: 0.503083
2024-04-11 17:31:03,559 P538965 INFO Save best model: monitor(max)=1.594485
2024-04-11 17:31:03,807 P538965 INFO ************ Epoch=17 end ************
2024-04-11 17:31:45,784 P538965 INFO Train loss: 1.001711
2024-04-11 17:31:45,785 P538965 INFO Evaluation @epoch 18 - batch 591: 
2024-04-11 17:31:59,507 P538965 INFO ===
2024-04-11 17:31:59,507 P538965 INFO [Metrics] AUC: 0.832082 - gAUC: 0.762545 - logloss: 0.502841
2024-04-11 17:31:59,508 P538965 INFO Save best model: monitor(max)=1.594627
2024-04-11 17:31:59,776 P538965 INFO ************ Epoch=18 end ************
2024-04-11 17:32:40,690 P538965 INFO Train loss: 1.000998
2024-04-11 17:32:40,690 P538965 INFO Evaluation @epoch 19 - batch 591: 
2024-04-11 17:32:53,819 P538965 INFO ===
2024-04-11 17:32:53,819 P538965 INFO [Metrics] AUC: 0.831941 - gAUC: 0.762487 - logloss: 0.503169
2024-04-11 17:32:53,820 P538965 INFO Monitor(max)=1.594428 STOP!
2024-04-11 17:32:53,820 P538965 INFO Reduce learning rate on plateau: 0.000100
2024-04-11 17:32:53,947 P538965 INFO ************ Epoch=19 end ************
2024-04-11 17:33:37,109 P538965 INFO Train loss: 0.931106
2024-04-11 17:33:37,109 P538965 INFO Evaluation @epoch 20 - batch 591: 
2024-04-11 17:33:50,681 P538965 INFO ===
2024-04-11 17:33:50,681 P538965 INFO [Metrics] AUC: 0.841294 - gAUC: 0.770733 - logloss: 0.492594
2024-04-11 17:33:50,682 P538965 INFO Save best model: monitor(max)=1.612027
2024-04-11 17:33:50,949 P538965 INFO ************ Epoch=20 end ************
2024-04-11 17:34:32,269 P538965 INFO Train loss: 0.896246
2024-04-11 17:34:32,269 P538965 INFO Evaluation @epoch 21 - batch 591: 
2024-04-11 17:34:44,592 P538965 INFO ===
2024-04-11 17:34:44,592 P538965 INFO [Metrics] AUC: 0.843484 - gAUC: 0.773231 - logloss: 0.490457
2024-04-11 17:34:44,593 P538965 INFO Save best model: monitor(max)=1.616715
2024-04-11 17:34:44,860 P538965 INFO ************ Epoch=21 end ************
2024-04-11 17:35:22,518 P538965 INFO Train loss: 0.877341
2024-04-11 17:35:22,518 P538965 INFO Evaluation @epoch 22 - batch 591: 
2024-04-11 17:35:36,731 P538965 INFO ===
2024-04-11 17:35:36,731 P538965 INFO [Metrics] AUC: 0.843866 - gAUC: 0.773809 - logloss: 0.491461
2024-04-11 17:35:36,732 P538965 INFO Save best model: monitor(max)=1.617675
2024-04-11 17:35:37,142 P538965 INFO ************ Epoch=22 end ************
2024-04-11 17:36:15,169 P538965 INFO Train loss: 0.862352
2024-04-11 17:36:15,170 P538965 INFO Evaluation @epoch 23 - batch 591: 
2024-04-11 17:36:28,757 P538965 INFO ===
2024-04-11 17:36:28,757 P538965 INFO [Metrics] AUC: 0.843158 - gAUC: 0.773321 - logloss: 0.494172
2024-04-11 17:36:28,757 P538965 INFO Monitor(max)=1.616479 STOP!
2024-04-11 17:36:28,758 P538965 INFO Reduce learning rate on plateau: 0.000010
2024-04-11 17:36:28,894 P538965 INFO ************ Epoch=23 end ************
2024-04-11 17:37:07,951 P538965 INFO Train loss: 0.827714
2024-04-11 17:37:07,952 P538965 INFO Evaluation @epoch 24 - batch 591: 
2024-04-11 17:37:21,676 P538965 INFO ===
2024-04-11 17:37:21,676 P538965 INFO [Metrics] AUC: 0.842308 - gAUC: 0.772528 - logloss: 0.501846
2024-04-11 17:37:21,677 P538965 INFO Monitor(max)=1.614836 STOP!
2024-04-11 17:37:21,677 P538965 INFO Reduce learning rate on plateau: 0.000001
2024-04-11 17:37:21,677 P538965 INFO ********* Epoch==24 early stop *********
2024-04-11 17:37:21,805 P538965 INFO Training finished.
2024-04-11 17:37:21,805 P538965 INFO Load best model: /mnt/public/lhh/code/model_zoo/TF4CTR/TF4CTR_torch/checkpoints/KKBox_x1_csv_9dad49f7/TF4CTRv2_KKBox_006_d1039748.model
2024-04-11 17:37:21,822 P538965 INFO ****** Validation evaluation ******
2024-04-11 17:37:35,640 P538965 INFO ===
2024-04-11 17:37:35,640 P538965 INFO [Metrics] logloss: 0.491461 - AUC: 0.843866 - gAUC: 0.773809
2024-04-11 17:37:35,691 P538965 INFO ******** Test evaluation ********
2024-04-11 17:37:35,691 P538965 INFO Loading data...
2024-04-11 17:37:35,692 P538965 INFO Loading data from h5: ../../../data/KKBox_x1_csv_9dad49f7/test.h5
2024-04-11 17:37:35,925 P538965 INFO Test samples: total/737743, blocks/1
2024-04-11 17:37:35,925 P538965 INFO Loading test data done.
2024-04-11 17:37:50,531 P538965 INFO ===
2024-04-11 17:37:50,532 P538965 INFO [Metrics] logloss: 0.491204 - AUC: 0.844024 - gAUC: 0.774828
