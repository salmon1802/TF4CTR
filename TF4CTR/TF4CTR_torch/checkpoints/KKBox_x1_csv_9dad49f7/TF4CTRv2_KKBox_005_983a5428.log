2024-04-11 17:13:25,237 P525734 INFO Params: {
    "DFM": "none",
    "SSM": "SER",
    "alpha": "0.25",
    "batch_norm": "True",
    "batch_size": "10000",
    "c": "0.7",
    "data_format": "csv",
    "data_root": "../../../data/",
    "dataset_id": "KKBox_x1_csv_9dad49f7",
    "debug_mode": "False",
    "early_stop_patience": "2",
    "easy_hidden_units": "[400]",
    "embedding_dim": "16",
    "embedding_regularizer": "0.0005",
    "epochs": "100",
    "eval_steps": "None",
    "feature_cols": "[{'active': True, 'dtype': 'int', 'name': 'group_id', 'preprocess': 'copy_from(msno)', 'remap': False, 'type': 'meta'}, {'active': True, 'dtype': 'str', 'name': ['msno', 'song_id', 'source_system_tab', 'source_screen_name', 'source_type', 'city', 'gender', 'registered_via', 'language'], 'type': 'categorical'}, {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'genre_ids', 'type': 'sequence'}, {'active': True, 'dtype': 'str', 'encoder': 'MaskedSumPooling', 'max_len': 3, 'name': 'artist_name', 'type': 'sequence'}, {'active': True, 'dtype': 'str', 'name': 'isrc', 'preprocess': 'extract_country_code', 'type': 'categorical'}, {'active': True, 'dtype': 'str', 'name': 'bd', 'preprocess': 'bucketize_age', 'type': 'categorical'}]",
    "feature_config": "None",
    "feature_specs": "None",
    "gamma": "1",
    "gpu": "0",
    "group_id": "group_id",
    "hard_hidden_units": "[400, 400, 400]",
    "hidden_activations": "relu",
    "label_col": "{'dtype': 'float', 'name': 'label'}",
    "learning_rate": "0.001",
    "loss": "binary_crossentropy",
    "metrics": "['logloss', 'AUC', 'gAUC']",
    "min_categr_count": "2",
    "model": "TF4CTRv2",
    "model_id": "TF4CTRv2_KKBox_005_983a5428",
    "model_root": "./checkpoints/",
    "monitor": "{'AUC': 1, 'gAUC': 1, 'logloss': 0}",
    "monitor_mode": "max",
    "net_dropout": "0.2",
    "net_regularizer": "0",
    "num_workers": "8",
    "optimizer": "adam",
    "pickle_feature_encoder": "True",
    "save_best_only": "True",
    "seed": "2023",
    "shuffle": "True",
    "task": "binary_classification",
    "test_data": "../../../data/KKBox_x1/test.csv",
    "train_data": "../../../data/KKBox_x1/train.csv",
    "use_features": "None",
    "valid_data": "../../../data/KKBox_x1/valid.csv",
    "verbose": "1"
}
2024-04-11 17:13:25,238 P525734 INFO Set up feature processor...
2024-04-11 17:13:25,238 P525734 WARNING Skip rebuilding ../../../data/KKBox_x1_csv_9dad49f7/feature_map.json. Please delete it manually if rebuilding is required.
2024-04-11 17:13:25,238 P525734 INFO Load feature_map from json: ../../../data/KKBox_x1_csv_9dad49f7/feature_map.json
2024-04-11 17:13:25,238 P525734 INFO Set column index...
2024-04-11 17:13:25,238 P525734 INFO Feature specs: {
    "artist_name": "{'source': '', 'type': 'sequence', 'feature_encoder': 'layers.MaskedAveragePooling()', 'padding_idx': 0, 'oov_idx': 25368, 'vocab_size': 25369, 'max_len': 3}",
    "bd": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 8, 'vocab_size': 9}",
    "city": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 22, 'vocab_size': 23}",
    "gender": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 3, 'vocab_size': 4}",
    "genre_ids": "{'source': '', 'type': 'sequence', 'feature_encoder': 'layers.MaskedAveragePooling()', 'padding_idx': 0, 'oov_idx': 482, 'vocab_size': 483, 'max_len': 3}",
    "group_id": "{'type': 'meta'}",
    "isrc": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 96, 'vocab_size': 97}",
    "language": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 11, 'vocab_size': 12}",
    "msno": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 29505, 'vocab_size': 29506}",
    "registered_via": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 6, 'vocab_size': 7}",
    "song_id": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 172296, 'vocab_size': 172297}",
    "source_screen_name": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 21, 'vocab_size': 22}",
    "source_system_tab": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 9, 'vocab_size': 10}",
    "source_type": "{'source': '', 'type': 'categorical', 'padding_idx': 0, 'oov_idx': 13, 'vocab_size': 14}"
}
2024-04-11 17:13:29,279 P525734 INFO Total number of parameters: 5918874.
2024-04-11 17:13:29,280 P525734 INFO Loading data...
2024-04-11 17:13:29,280 P525734 INFO Loading data from h5: ../../../data/KKBox_x1_csv_9dad49f7/train.h5
2024-04-11 17:13:33,781 P525734 INFO Train samples: total/5901932, blocks/1
2024-04-11 17:13:33,781 P525734 INFO Loading data from h5: ../../../data/KKBox_x1_csv_9dad49f7/valid.h5
2024-04-11 17:13:34,494 P525734 INFO Validation samples: total/737743, blocks/1
2024-04-11 17:13:34,494 P525734 INFO Loading train and validation data done.
2024-04-11 17:13:34,494 P525734 INFO Start training: 591 batches/epoch
2024-04-11 17:13:34,494 P525734 INFO ************ Epoch=1 start ************
2024-04-11 17:14:15,775 P525734 INFO Train loss: 1.134764
2024-04-11 17:14:15,775 P525734 INFO Evaluation @epoch 1 - batch 591: 
2024-04-11 17:14:28,168 P525734 INFO ===
2024-04-11 17:14:28,168 P525734 INFO [Metrics] AUC: 0.804183 - gAUC: 0.727245 - logloss: 0.543835
2024-04-11 17:14:28,169 P525734 INFO Save best model: monitor(max)=1.531428
2024-04-11 17:14:28,370 P525734 INFO ************ Epoch=1 end ************
2024-04-11 17:15:04,517 P525734 INFO Train loss: 1.077382
2024-04-11 17:15:04,517 P525734 INFO Evaluation @epoch 2 - batch 591: 
2024-04-11 17:15:17,468 P525734 INFO ===
2024-04-11 17:15:17,468 P525734 INFO [Metrics] AUC: 0.814005 - gAUC: 0.740658 - logloss: 0.530397
2024-04-11 17:15:17,469 P525734 INFO Save best model: monitor(max)=1.554663
2024-04-11 17:15:17,776 P525734 INFO ************ Epoch=2 end ************
2024-04-11 17:15:48,422 P525734 INFO Train loss: 1.071573
2024-04-11 17:15:48,422 P525734 INFO Evaluation @epoch 3 - batch 591: 
2024-04-11 17:15:59,649 P525734 INFO ===
2024-04-11 17:15:59,650 P525734 INFO [Metrics] AUC: 0.819498 - gAUC: 0.748460 - logloss: 0.523098
2024-04-11 17:15:59,650 P525734 INFO Save best model: monitor(max)=1.567958
2024-04-11 17:15:59,946 P525734 INFO ************ Epoch=3 end ************
2024-04-11 17:16:39,366 P525734 INFO Train loss: 1.069380
2024-04-11 17:16:39,367 P525734 INFO Evaluation @epoch 4 - batch 591: 
2024-04-11 17:16:53,299 P525734 INFO ===
2024-04-11 17:16:53,300 P525734 INFO [Metrics] AUC: 0.821769 - gAUC: 0.751257 - logloss: 0.520070
2024-04-11 17:16:53,300 P525734 INFO Save best model: monitor(max)=1.573026
2024-04-11 17:16:53,629 P525734 INFO ************ Epoch=4 end ************
2024-04-11 17:17:34,029 P525734 INFO Train loss: 1.067558
2024-04-11 17:17:34,030 P525734 INFO Evaluation @epoch 5 - batch 591: 
2024-04-11 17:17:48,745 P525734 INFO ===
2024-04-11 17:17:48,745 P525734 INFO [Metrics] AUC: 0.824135 - gAUC: 0.754624 - logloss: 0.516111
2024-04-11 17:17:48,745 P525734 INFO Save best model: monitor(max)=1.578759
2024-04-11 17:17:49,048 P525734 INFO ************ Epoch=5 end ************
2024-04-11 17:18:28,305 P525734 INFO Train loss: 1.065980
2024-04-11 17:18:28,305 P525734 INFO Evaluation @epoch 6 - batch 591: 
2024-04-11 17:18:41,920 P525734 INFO ===
2024-04-11 17:18:41,920 P525734 INFO [Metrics] AUC: 0.825427 - gAUC: 0.755858 - logloss: 0.516763
2024-04-11 17:18:41,920 P525734 INFO Save best model: monitor(max)=1.581285
2024-04-11 17:18:42,223 P525734 INFO ************ Epoch=6 end ************
2024-04-11 17:19:22,445 P525734 INFO Train loss: 1.064560
2024-04-11 17:19:22,446 P525734 INFO Evaluation @epoch 7 - batch 591: 
2024-04-11 17:19:34,734 P525734 INFO ===
2024-04-11 17:19:34,735 P525734 INFO [Metrics] AUC: 0.826244 - gAUC: 0.757226 - logloss: 0.514480
2024-04-11 17:19:34,735 P525734 INFO Save best model: monitor(max)=1.583470
2024-04-11 17:19:34,997 P525734 INFO ************ Epoch=7 end ************
2024-04-11 17:20:16,536 P525734 INFO Train loss: 1.063187
2024-04-11 17:20:16,536 P525734 INFO Evaluation @epoch 8 - batch 591: 
2024-04-11 17:20:29,329 P525734 INFO ===
2024-04-11 17:20:29,329 P525734 INFO [Metrics] AUC: 0.827165 - gAUC: 0.758228 - logloss: 0.512664
2024-04-11 17:20:29,329 P525734 INFO Save best model: monitor(max)=1.585393
2024-04-11 17:20:29,620 P525734 INFO ************ Epoch=8 end ************
2024-04-11 17:21:11,814 P525734 INFO Train loss: 1.061758
2024-04-11 17:21:11,814 P525734 INFO Evaluation @epoch 9 - batch 591: 
2024-04-11 17:21:25,869 P525734 INFO ===
2024-04-11 17:21:25,869 P525734 INFO [Metrics] AUC: 0.828274 - gAUC: 0.759119 - logloss: 0.512501
2024-04-11 17:21:25,870 P525734 INFO Save best model: monitor(max)=1.587393
2024-04-11 17:21:26,181 P525734 INFO ************ Epoch=9 end ************
2024-04-11 17:22:06,791 P525734 INFO Train loss: 1.060502
2024-04-11 17:22:06,792 P525734 INFO Evaluation @epoch 10 - batch 591: 
2024-04-11 17:22:19,415 P525734 INFO ===
2024-04-11 17:22:19,416 P525734 INFO [Metrics] AUC: 0.828458 - gAUC: 0.759958 - logloss: 0.512039
2024-04-11 17:22:19,416 P525734 INFO Save best model: monitor(max)=1.588415
2024-04-11 17:22:19,701 P525734 INFO ************ Epoch=10 end ************
2024-04-11 17:23:01,467 P525734 INFO Train loss: 1.059528
2024-04-11 17:23:01,467 P525734 INFO Evaluation @epoch 11 - batch 591: 
2024-04-11 17:23:15,659 P525734 INFO ===
2024-04-11 17:23:15,660 P525734 INFO [Metrics] AUC: 0.829028 - gAUC: 0.760157 - logloss: 0.511174
2024-04-11 17:23:15,660 P525734 INFO Save best model: monitor(max)=1.589185
2024-04-11 17:23:15,933 P525734 INFO ************ Epoch=11 end ************
2024-04-11 17:23:56,988 P525734 INFO Train loss: 1.058176
2024-04-11 17:23:56,988 P525734 INFO Evaluation @epoch 12 - batch 591: 
2024-04-11 17:24:09,715 P525734 INFO ===
2024-04-11 17:24:09,715 P525734 INFO [Metrics] AUC: 0.829381 - gAUC: 0.760131 - logloss: 0.510389
2024-04-11 17:24:09,716 P525734 INFO Save best model: monitor(max)=1.589512
2024-04-11 17:24:10,005 P525734 INFO ************ Epoch=12 end ************
2024-04-11 17:24:47,319 P525734 INFO Train loss: 1.057617
2024-04-11 17:24:47,319 P525734 INFO Evaluation @epoch 13 - batch 591: 
2024-04-11 17:25:00,110 P525734 INFO ===
2024-04-11 17:25:00,111 P525734 INFO [Metrics] AUC: 0.829785 - gAUC: 0.760568 - logloss: 0.509525
2024-04-11 17:25:00,112 P525734 INFO Save best model: monitor(max)=1.590353
2024-04-11 17:25:00,407 P525734 INFO ************ Epoch=13 end ************
2024-04-11 17:25:39,215 P525734 INFO Train loss: 1.056399
2024-04-11 17:25:39,215 P525734 INFO Evaluation @epoch 14 - batch 591: 
2024-04-11 17:25:52,266 P525734 INFO ===
2024-04-11 17:25:52,266 P525734 INFO [Metrics] AUC: 0.830230 - gAUC: 0.761083 - logloss: 0.509840
2024-04-11 17:25:52,266 P525734 INFO Save best model: monitor(max)=1.591314
2024-04-11 17:25:52,531 P525734 INFO ************ Epoch=14 end ************
2024-04-11 17:26:29,652 P525734 INFO Train loss: 1.055718
2024-04-11 17:26:29,652 P525734 INFO Evaluation @epoch 15 - batch 591: 
2024-04-11 17:26:42,488 P525734 INFO ===
2024-04-11 17:26:42,488 P525734 INFO [Metrics] AUC: 0.830505 - gAUC: 0.761697 - logloss: 0.509312
2024-04-11 17:26:42,489 P525734 INFO Save best model: monitor(max)=1.592202
2024-04-11 17:26:42,768 P525734 INFO ************ Epoch=15 end ************
2024-04-11 17:27:20,643 P525734 INFO Train loss: 1.055287
2024-04-11 17:27:20,644 P525734 INFO Evaluation @epoch 16 - batch 591: 
2024-04-11 17:27:33,168 P525734 INFO ===
2024-04-11 17:27:33,168 P525734 INFO [Metrics] AUC: 0.831195 - gAUC: 0.762013 - logloss: 0.508077
2024-04-11 17:27:33,169 P525734 INFO Save best model: monitor(max)=1.593208
2024-04-11 17:27:33,467 P525734 INFO ************ Epoch=16 end ************
2024-04-11 17:28:11,641 P525734 INFO Train loss: 1.054542
2024-04-11 17:28:11,641 P525734 INFO Evaluation @epoch 17 - batch 591: 
2024-04-11 17:28:24,675 P525734 INFO ===
2024-04-11 17:28:24,675 P525734 INFO [Metrics] AUC: 0.831345 - gAUC: 0.762557 - logloss: 0.507414
2024-04-11 17:28:24,676 P525734 INFO Save best model: monitor(max)=1.593902
2024-04-11 17:28:24,929 P525734 INFO ************ Epoch=17 end ************
2024-04-11 17:29:03,051 P525734 INFO Train loss: 1.054139
2024-04-11 17:29:03,052 P525734 INFO Evaluation @epoch 18 - batch 591: 
2024-04-11 17:29:16,237 P525734 INFO ===
2024-04-11 17:29:16,238 P525734 INFO [Metrics] AUC: 0.831535 - gAUC: 0.762764 - logloss: 0.507409
2024-04-11 17:29:16,238 P525734 INFO Save best model: monitor(max)=1.594299
2024-04-11 17:29:16,520 P525734 INFO ************ Epoch=18 end ************
2024-04-11 17:29:56,963 P525734 INFO Train loss: 1.053441
2024-04-11 17:29:56,964 P525734 INFO Evaluation @epoch 19 - batch 591: 
2024-04-11 17:30:10,518 P525734 INFO ===
2024-04-11 17:30:10,518 P525734 INFO [Metrics] AUC: 0.832098 - gAUC: 0.763508 - logloss: 0.507347
2024-04-11 17:30:10,519 P525734 INFO Save best model: monitor(max)=1.595606
2024-04-11 17:30:10,780 P525734 INFO ************ Epoch=19 end ************
2024-04-11 17:30:51,998 P525734 INFO Train loss: 1.052850
2024-04-11 17:30:51,998 P525734 INFO Evaluation @epoch 20 - batch 591: 
2024-04-11 17:31:05,261 P525734 INFO ===
2024-04-11 17:31:05,261 P525734 INFO [Metrics] AUC: 0.832408 - gAUC: 0.763722 - logloss: 0.506901
2024-04-11 17:31:05,261 P525734 INFO Save best model: monitor(max)=1.596130
2024-04-11 17:31:05,557 P525734 INFO ************ Epoch=20 end ************
2024-04-11 17:31:47,173 P525734 INFO Train loss: 1.052118
2024-04-11 17:31:47,173 P525734 INFO Evaluation @epoch 21 - batch 591: 
2024-04-11 17:32:00,889 P525734 INFO ===
2024-04-11 17:32:00,890 P525734 INFO [Metrics] AUC: 0.832511 - gAUC: 0.764285 - logloss: 0.507574
2024-04-11 17:32:00,890 P525734 INFO Save best model: monitor(max)=1.596796
2024-04-11 17:32:01,165 P525734 INFO ************ Epoch=21 end ************
2024-04-11 17:32:42,827 P525734 INFO Train loss: 1.051822
2024-04-11 17:32:42,827 P525734 INFO Evaluation @epoch 22 - batch 591: 
2024-04-11 17:32:55,802 P525734 INFO ===
2024-04-11 17:32:55,802 P525734 INFO [Metrics] AUC: 0.832376 - gAUC: 0.763531 - logloss: 0.506994
2024-04-11 17:32:55,803 P525734 INFO Monitor(max)=1.595907 STOP!
2024-04-11 17:32:55,803 P525734 INFO Reduce learning rate on plateau: 0.000100
2024-04-11 17:32:55,945 P525734 INFO ************ Epoch=22 end ************
2024-04-11 17:33:38,679 P525734 INFO Train loss: 0.975897
2024-04-11 17:33:38,679 P525734 INFO Evaluation @epoch 23 - batch 591: 
2024-04-11 17:33:51,818 P525734 INFO ===
2024-04-11 17:33:51,819 P525734 INFO [Metrics] AUC: 0.842035 - gAUC: 0.771716 - logloss: 0.489984
2024-04-11 17:33:51,819 P525734 INFO Save best model: monitor(max)=1.613751
2024-04-11 17:33:52,077 P525734 INFO ************ Epoch=23 end ************
2024-04-11 17:34:33,104 P525734 INFO Train loss: 0.938189
2024-04-11 17:34:33,104 P525734 INFO Evaluation @epoch 24 - batch 591: 
2024-04-11 17:34:45,836 P525734 INFO ===
2024-04-11 17:34:45,836 P525734 INFO [Metrics] AUC: 0.843677 - gAUC: 0.773782 - logloss: 0.499641
2024-04-11 17:34:45,837 P525734 INFO Save best model: monitor(max)=1.617459
2024-04-11 17:34:46,118 P525734 INFO ************ Epoch=24 end ************
2024-04-11 17:35:24,181 P525734 INFO Train loss: 0.917137
2024-04-11 17:35:24,182 P525734 INFO Evaluation @epoch 25 - batch 591: 
2024-04-11 17:35:37,223 P525734 INFO ===
2024-04-11 17:35:37,223 P525734 INFO [Metrics] AUC: 0.843684 - gAUC: 0.774077 - logloss: 0.502203
2024-04-11 17:35:37,224 P525734 INFO Save best model: monitor(max)=1.617761
2024-04-11 17:35:37,537 P525734 INFO ************ Epoch=25 end ************
2024-04-11 17:36:15,033 P525734 INFO Train loss: 0.900651
2024-04-11 17:36:15,033 P525734 INFO Evaluation @epoch 26 - batch 591: 
2024-04-11 17:36:28,526 P525734 INFO ===
2024-04-11 17:36:28,527 P525734 INFO [Metrics] AUC: 0.842837 - gAUC: 0.773242 - logloss: 0.506857
2024-04-11 17:36:28,527 P525734 INFO Monitor(max)=1.616079 STOP!
2024-04-11 17:36:28,528 P525734 INFO Reduce learning rate on plateau: 0.000010
2024-04-11 17:36:28,688 P525734 INFO ************ Epoch=26 end ************
2024-04-11 17:37:07,967 P525734 INFO Train loss: 0.863640
2024-04-11 17:37:07,967 P525734 INFO Evaluation @epoch 27 - batch 591: 
2024-04-11 17:37:21,577 P525734 INFO ===
2024-04-11 17:37:21,577 P525734 INFO [Metrics] AUC: 0.842556 - gAUC: 0.773070 - logloss: 0.515547
2024-04-11 17:37:21,578 P525734 INFO Monitor(max)=1.615626 STOP!
2024-04-11 17:37:21,578 P525734 INFO Reduce learning rate on plateau: 0.000001
2024-04-11 17:37:21,578 P525734 INFO ********* Epoch==27 early stop *********
2024-04-11 17:37:21,700 P525734 INFO Training finished.
2024-04-11 17:37:21,700 P525734 INFO Load best model: /mnt/public/lhh/code/model_zoo/TF4CTR/TF4CTR_torch/checkpoints/KKBox_x1_csv_9dad49f7/TF4CTRv2_KKBox_005_983a5428.model
2024-04-11 17:37:21,725 P525734 INFO ****** Validation evaluation ******
2024-04-11 17:37:36,326 P525734 INFO ===
2024-04-11 17:37:36,326 P525734 INFO [Metrics] logloss: 0.502203 - AUC: 0.843684 - gAUC: 0.774077
2024-04-11 17:37:36,369 P525734 INFO ******** Test evaluation ********
2024-04-11 17:37:36,370 P525734 INFO Loading data...
2024-04-11 17:37:36,370 P525734 INFO Loading data from h5: ../../../data/KKBox_x1_csv_9dad49f7/test.h5
2024-04-11 17:37:36,582 P525734 INFO Test samples: total/737743, blocks/1
2024-04-11 17:37:36,582 P525734 INFO Loading test data done.
2024-04-11 17:37:50,011 P525734 INFO ===
2024-04-11 17:37:50,011 P525734 INFO [Metrics] logloss: 0.501296 - AUC: 0.844142 - gAUC: 0.775415
